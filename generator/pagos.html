<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Pago en Cripto | PlataformA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
  <link rel="stylesheet" href="styles.css">
  <style>
    body { background: #f7fafd; }
    .generator-box {
      box-sizing: border-box;
      border-radius: 22px;
      box-shadow: 0 4px 26px 0 #e0e8f765;
      margin: 26px auto 0 auto;
      max-width: 370px;
      min-width: 0;
      background: #fff;
      position: relative;
      padding: 23px 16px 13px 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .logo-top {
      margin-bottom: 13px;
      text-align: center;
    }
    .logo-top img {
      width: 57px; height: 57px; object-fit: cover; border-radius: 14px;
      box-shadow: 0 2px 16px 0 #c6d0e1a0; background: #fff;
      border: 2px solid #f3f6fb;
    }
    .pay-title {
      font-weight: 900;
      font-size: 1.28rem;
      color: #23386c;
      text-align: center;
      margin-bottom: 2px;
      margin-top: 3px;
      letter-spacing: 0.01em;
    }
    .pay-desc {
      font-size: 1.03rem;
      color: #4c5a6f;
      text-align: center;
      margin-bottom: 7px;
      margin-top: 0;
    }
    .monto-main {
      font-size: 1.15rem;
      font-weight: 700;
      margin: 13px 0 2px 0;
      text-align: center;
      letter-spacing: 0.01em;
      line-height: 1.21;
    }
    .monto-ars { color: #2060dd; }
    .monto-usdt { color: #21a266; }
    .monto-extra {
      font-size: 0.96rem; color: #5f6d85; text-align: center; margin-bottom: 3px; line-height: 1.12;
    }
    .qr-wrap {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      margin: 7px 0 2px 0;
    }
    #qrPago {
      border-radius: 12px;
      box-shadow: 0 3px 11px 0 #bcd3ee33, 0 0px 0 #fff;
      background: #f4f7fd;
      padding: 6px;
      width: 150px;
      height: 150px;
    }
    .address-copy-wrap {
      display: flex; justify-content: center; align-items: center; margin: 8px 0 3px 0; width: 100%;
    }
    .address-field {
      width: 68%; min-width: 90px; font-size: 0.98rem; padding: 5px 7px; border-radius: 8px;
      border: 1.2px solid #d9e4f4; background: #f8fbff;
      box-shadow: 0 1px 3px #eaf2ff60 inset;
      transition: border .16s;
      margin-right: 7px;
      text-align: center;
      font-family: 'Inter', Arial, sans-serif;
      cursor: pointer;
    }
    .address-field:focus {
      border: 1.7px solid #2060dd;
      outline: none;
    }
    .copy-btn {
      padding: 6px 11px; border-radius: 9px; background: linear-gradient(90deg,#2050dc 40%,#45caff 120%);
      color: #fff; border: none; font-weight: 700; font-size: 0.98rem;
      box-shadow: 0 1px 5px 0 #93c3ff25;
      cursor: pointer; transition: background .18s, box-shadow .14s, transform .08s;
      display: flex; align-items: center; gap: 6px; height: 33px;
      white-space: nowrap;
    }
    .copy-btn:hover, .copy-btn.copied {
      background: linear-gradient(90deg,#1a46bd 40%,#2bb7d6 120%);
      box-shadow: 0 2px 7px 0 #5eaaff35;
      transform: scale(1.025);
    }
    .copy-icon {
      font-size: 1.13em;
      vertical-align: middle;
      opacity: 0.88;
      margin-right: 1px;
    }
    .pago-red {
      font-size: 1.02rem; color: #21a266; font-weight: 700; margin: 7px 0 0 0; text-align: center; display: flex; justify-content: center; align-items: center; gap: 4px;
    }
    .polygon-icon {
      font-size: 1.15em;
      vertical-align: middle;
      margin-right: 2px;
      opacity: 0.85;
    }
    .info-banner {
      background: #f4f7fd; color: #38485c; border-radius: 10px; margin: 13px auto 3px auto;
      text-align: center; padding: 9px 10px 9px 10px; font-size: 0.97rem;
      border: 1px solid #e0eafc; max-width: 97%; box-shadow: 0 1px 5px 0 #e2e8f065;
      font-weight: 500; line-height: 1.45;
    }
    .powered-plataforma {
      margin-top: 14px;
      text-align: center;
      opacity: 0.83;
      font-size: 0.98rem;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .powered-plataforma a {
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 5px;
      color: #2987fa;
      transition: opacity .18s, color .16s;
      font-weight: 600;
    }
    .powered-plataforma a:hover {
      opacity: 1;
      text-decoration: underline;
      color: #15399b;
    }
    .powered-plataforma img {
      width: 18px; height: 18px; border-radius: 5px; box-shadow: 0 1px 4px #ccd9ee50;
      background: #fff;
      margin-right: 2px;
    }
    @media (max-width: 540px) {
      .generator-box { margin: 9px auto 0 auto; border-radius: 11px; max-width: 99vw; padding: 10px 4px 9px 4px; }
      .logo-top img { width: 44px; height: 44px; border-radius: 9px; }
      .pay-title { font-size: 1.05rem; }
      .pay-desc { font-size: 0.93rem; }
      .monto-main { font-size: 0.99rem; }
      #qrPago { width: 116px; height: 116px; padding: 3px; }
      .address-field { font-size: 0.91rem; }
      .copy-btn { font-size: 0.93rem; padding: 5px 8px; height: 27px; }
      .info-banner { font-size: 0.89rem; padding: 7px 2px; }
      .powered-plataforma { font-size: 0.87rem; margin-top: 8px; }
      .powered-plataforma img { width: 15px; height: 15px; }
    }
  </style>
</head>
<body>
  <div class="main-wrap-gen">
    <div class="generator-box" id="pagoBox">
      <div class="logo-top" id="logoBox"></div>
      <div class="pay-title" id="payTitle"></div>
      <div class="pay-desc" id="payDesc"></div>
      <div id="equivalentePago"></div>
      <div id="qrPagoBox"></div>
      <div id="infoPago"></div>
      <!-- Powered by PlataformA.ar -->
      <div class="powered-plataforma">
        <a href="https://www.plataforma.ar" target="_blank" rel="noopener">
          <img src="assets/logo.png" alt="PlataformA logo">
          <span>Powered by PlataformA.ar</span>
        </a>
      </div>
    </div>
  </div>
  <script>
    // --- –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ---
    function getID() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }
    const id = getID();
    const datos = JSON.parse(localStorage.getItem('plataforma_pago_' + id));

    if (!datos) {
      document.getElementById('pagoBox').innerHTML = '<h2>No se encontr√≥ el pago</h2>';
    } else {
      // --- –õ–æ–≥–æ—Ç–∏–ø: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±—ã–ª –≤—ã–±—Ä–∞–Ω ---
      if (datos.logoBase64) {
        document.getElementById('logoBox').innerHTML = `<img src="${datos.logoBase64}" alt="Logo del negocio">`;
      } else {
        document.getElementById('logoBox').innerHTML = '';
      }
      // --- –ù–∞–∑–≤–∞–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ —Ü–µ–Ω—Ç—Ä—É ---
      document.getElementById('payTitle').textContent = datos.nombre;
      document.getElementById('payDesc').textContent = datos.descripcion;

      // --- –°—É–º–º–∞, QR, –ø–æ–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∏–Ω—Ñ–æ ---
      let montoParaPago = datos.monto;
      let monedaParaPago = datos.moneda;

      function mostrarPago(monto, moneda, extra = "") {
        document.getElementById('equivalentePago').innerHTML = `
          <div class="monto-main">
            <b>Monto:</b> <span class="monto-ars">${datos.monto} ${datos.moneda}</span>
            ${moneda === "USDT" && datos.moneda === "ARS" ? `<span class="monto-usdt"> ‚âà ${monto} USDT</span>` : ""}
          </div>
          <div class="monto-extra">${extra}</div>
        `;
        // QR
        document.getElementById('qrPagoBox').innerHTML = `
          <div class="qr-wrap">
            <canvas id="qrPago"></canvas>
          </div>
          <div class="address-copy-wrap">
            <input type="text" id="direccionCopia" class="address-field" readonly>
            <button onclick="copiarDireccion()" class="copy-btn" id="btnCopy">
              <span class="copy-icon">üìã</span> Copiar direcci√≥n
            </button>
          </div>
        `;
        new QRious({
          element: document.getElementById('qrPago'),
          value: datos.wallet,
          size: 150
        });
        document.getElementById('direccionCopia').value = datos.wallet;
        document.getElementById('direccionCopia').addEventListener('click', copiarDireccion);

        document.getElementById('infoPago').innerHTML = `
          <div class="pago-red"><span class="polygon-icon">üî∑</span>Red: <b>Polygon (POS)</b></div>
          <div class="info-banner">
            Escane√° el QR o copi√° el address en tu billetera o exchange. Eleg√≠ la red Polygon para las comisiones m√°s bajas.
          </div>
        `;
      }

      // --- ARS: –ø–æ–ª—É—á–∏—Ç—å —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç, –∏–Ω–∞—á–µ ‚Äî –ø—Ä–æ—Å—Ç–æ —Å—É–º–º—É ---
      if (datos.moneda === "ARS" && datos.monto) {
        fetch('https://api.binance.com/api/v3/ticker/price?symbol=USDTARS')
          .then(r => r.json())
          .then(usdt => {
            const montoARS = parseFloat(datos.monto);
            const precioUSDT = parseFloat(usdt.price);
            if (precioUSDT && precioUSDT > 0) {
              const eqUSDT = (montoARS / precioUSDT).toFixed(4);
              mostrarPago(eqUSDT, "USDT", `(1 USDT = ${precioUSDT.toFixed(2)} ARS)`);
            } else {
              mostrarPago("", "USDT", "");
            }
          })
          .catch(() => {
            mostrarPago("", "USDT", "");
          });
      } else {
        mostrarPago(montoParaPago, monedaParaPago, "");
      }
    }

    // --- –ö–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è + –∞–Ω–∏–º–∞—Ü–∏—è ---
    function copiarDireccion() {
      const field = document.getElementById('direccionCopia');
      field.select();
      field.setSelectionRange(0, 99_999);
      document.execCommand('copy');
      field.blur();
      // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å + –ø–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
      const btn = document.getElementById('btnCopy');
      btn.classList.add("copied");
      btn.innerHTML = "<span class='copy-icon'>‚úÖ</span> ¬°Copiado!";
      setTimeout(() => {
        btn.classList.remove("copied");
        btn.innerHTML = `<span class="copy-icon">üìã</span> Copiar direcci√≥n`;
      }, 1200);
    }
  </script>
</body>
</html>
